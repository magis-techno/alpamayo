# REQ-001: 场景框架初始需求

> 创建日期: 2026-01-15  
> 状态: ✅ 已实现  
> 优先级: P0

---

## 1. 背景

### 1.1 问题陈述

现有场景分类存在以下问题：

**第二维度（专题场景集/事件维度）问题：**
- 粒度不一致：部分原子化（如速度、加速度），部分较粗（如巡航）
- 主轴混乱：混合了行为、设施、功能等多个维度
- 缺乏管理：场景之间边界模糊，难以使用

**第三维度（问题/体验维度）特点：**
- 面向诊断：从业务问题出发的分类
- 需要关联：可与场景分类建立多对多关系

### 1.2 现有分类的主轴混合分析

```
现有分类维度混合示例：
├── 按自车行为：巡航、换道、跟车
├── 按道路结构：收费站、环岛、路口、隧道
├── 按功能模块：AEB、运动规划
├── 按交互目标：cutin、VRU横穿
└── 按采集批次：340168数据、主动采集数据
```

---

## 2. 需求目标

### 2.1 核心目标

场景框架需要同时支持两个核心任务：

| 目标 | 描述 | 用途 |
|------|------|------|
| **数据均衡去重** | 提供统一的保护维度 | 确保场景多样性和覆盖度 |
| **CoC标注规格** | 提供场景定义，指导标注 | keyframe、起止、推理要素的定义 |

### 2.2 参考依据

参考 Alpamayo-R1 论文（arXiv:2511.00088）的 Chain of Causation (CoC) 设计：
- **Driving Decision**: 闭集，9种纵向 + 9种横向
- **Critical Components**: 开集，7大类因果因素
- **Scenario**: 用于Clip Selection，识别关键推理时刻

---

## 3. 具体需求

### 3.1 顶层设计需求 [REQ-001.1]

**需求描述：**
需要有一个顶层设计，包含场景分类的基本原则，然后再往下细化。

**具体要求：**
1. 明确主轴选择（单一主轴 vs 多维度）
2. 讨论是否需要MECE（互斥且完备）
3. 定义层级划分标准（L1/L2/L3的区分依据）
4. 定义粒度控制原则

**实现状态：** ✅ 已实现于 `docs/01_design_overview.md`

**实现决策：**
- 主轴选择：决策触发事件（Decision Trigger）
- MECE要求：L1/L2层严格MECE，一条数据归属唯一叶子节点
- 层级标准：L1=触发大类，L2=具体事件，L3=标注规格不同时细分

---

### 3.2 标注规格需求 [REQ-001.2]

**需求描述：**
CoC标注需要尽快定出规格，比如变道场景，变道的准备阶段如何定义，应该怎么标，什么算终止等等。

**具体要求：**
1. 每个场景需要定义：
   - Keyframe规则（触发时刻）
   - 起止时刻（开始/结束条件）
   - 打包范围（上下文包含多少）
   - Critical Components（关键因素）
   - CoC推理链模板
   
2. 换道场景需要明确：
   - 准备阶段（Prepare）：如何定义
   - 执行阶段（Execute）：如何标注
   - 完成阶段（Complete）：什么算终止

**实现状态：** ✅ 已实现于 `docs/02_labeling_spec.md`

**换道阶段定义（实现）：**
```yaml
准备阶段 (Prepare): routing command → 开始Gap Matching
执行阶段 (Execute): 开始偏离中心线 → 进入目标车道50%
完成阶段 (Complete): 进入目标车道50% → 目标车道居中稳定

结束条件: 横向速度<0.1m/s 且 距中心线<0.3m 持续2s
```

---

### 3.3 数据交换格式需求 [REQ-001.3]

**需求描述：**
需要定义数据交换格式（interface），确保各系统使用统一格式。

**具体要求：**
1. 场景分类数据格式（YAML）
2. 标注输入数据格式（Clip元数据、场景标签、Keyframe建议）
3. CoC标注输出格式（JSON Schema）
4. 数据挖掘接口格式

**实现状态：** ✅ 已实现于 `docs/03_data_interface.md` 和 `schema/*.json`

---

### 3.4 场景分类体系需求 [REQ-001.4]

**需求描述：**
建立统一的场景分类体系，参考论文中的场景定义。

**具体要求：**
1. 分析现有分类与论文分类的关系
2. 确定是否可以做到primary场景（互斥的主场景）
3. 建立L1-L2-L3层级结构

**实现状态：** ✅ 已实现于 `schema/scenario_taxonomy.yaml`

**实现结果：**
- 5个L1大类（reactive_agent, reactive_road, reactive_rule, proactive, safety）
- 19个L2场景
- 40+个L3变体

---

### 3.5 示例数据需求 [REQ-001.5]

**需求描述：**
提供标注示例数据，帮助理解和验证格式。

**具体要求：**
1. 提供多种场景类型的示例
2. 示例需要符合JSON Schema
3. 包含详细的annotation说明

**实现状态：** ✅ 已实现于 `examples/*.json`

**已提供示例：**
- `cutin_urgent_example.json` - 紧急Cutin（Reactive）
- `lane_change_example.json` - 导航换道（Proactive）
- `vru_crossing_example.json` - VRU横穿（Reactive）
- `blind_spot_example.json` - 盲区减速（Proactive）

---

## 4. 文档规划

**原始需求：**
规划三个文档：
1. 整体方案（含基础逻辑）
2. 标注规格
3. 数据交换格式（interface）

**实现映射：**

| 规划文档 | 实现文档 |
|----------|----------|
| 整体方案 | `docs/01_design_overview.md` |
| 标注规格 | `docs/02_labeling_spec.md` |
| 数据交换格式 | `docs/03_data_interface.md` |

---

## 5. 讨论记录

### 5.1 MECE讨论

**问题：** 是否需要MECE？

**分析：**
- 论文中的Scenario不是严格MECE（同一clip可能有多个keyframe）
- 但Driving Decision是严格MECE（每个keyframe只有一个纵向+一个横向）

**决策：**
- 场景分类采用MECE原则
- 一条数据归属到唯一的叶子节点
- 多事件并发时，选择"主触发事件"

### 5.2 主轴选择讨论

**选项A：** 单轴 + 严格MECE
- 优点：分类清晰，数据保护维度明确
- 缺点：需要统一现有分类

**选项B：** 主场景 + 辅助标签
- 优点：灵活，兼容现有分类
- 缺点：可能造成混乱

**决策：** 选择选项A，以"决策触发事件"为主轴

---

## 6. 后续规划

| 阶段 | 任务 | 状态 |
|------|------|------|
| Phase 1 | 完成整体设计方案 | ✅ |
| Phase 2 | 完成核心场景标注规格 | ✅ |
| Phase 3 | 定义数据交换格式 | ✅ |
| Phase 4 | 补充剩余场景规格 | ✅ |
| Phase 5 | 准备示例数据 | ✅ |
| Phase 6 | 标注试点验证 | 🔲 待规划 |
| Phase 7 | 迭代优化 | 🔲 待规划 |
